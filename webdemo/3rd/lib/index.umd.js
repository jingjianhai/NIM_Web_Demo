!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("../assets/sdk/NIM_Web_WebRTC2_v3.7.0.js"),require("../assets/sdk/NIM_Web_SDK_v8.1.0.js")):"function"==typeof define&&define.amd?define(["exports","../assets/sdk/NIM_Web_WebRTC2_v3.7.0.js","../assets/sdk/NIM_Web_SDK_v8.1.0.js"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).NRTCCalling={},e.WebRTC2,e.SDK)}(this,(function(e,t,n){"use strict";function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=s(t),r=s(n),a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var o=function(){return(o=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function l(e,t,n,s){return new(n||(n=Promise))((function(i,r){function a(e){try{l(s.next(e))}catch(e){r(e)}}function o(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}l((s=s.apply(e,t||[])).next())}))}function c(e,t){var n,s,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,s&&(i=2&r[0]?s.return:r[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,r[1])).done)return i;switch(s=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,s=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],s=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}}function u(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var s,i,r=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(s=r.next()).done;)a.push(s.value)}catch(e){i={error:e}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return a}function h(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e}var d,f=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){var t=Object.prototype.hasOwnProperty,n="~";function s(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function r(e,t,s,r,a){if("function"!=typeof s)throw new TypeError("The listener must be a function");var o=new i(s,r||e,a),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function o(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(n=!1)),o.prototype.eventNames=function(){var e,s,i=[];if(0===this._eventsCount)return i;for(s in e=this._events)t.call(e,s)&&i.push(n?s.slice(1):s);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(e){var t=n?n+e:e,s=this._events[t];if(!s)return[];if(s.fn)return[s.fn];for(var i=0,r=s.length,a=new Array(r);i<r;i++)a[i]=s[i].fn;return a},o.prototype.listenerCount=function(e){var t=n?n+e:e,s=this._events[t];return s?s.fn?1:s.length:0},o.prototype.emit=function(e,t,s,i,r,a){var o=n?n+e:e;if(!this._events[o])return!1;var l,c,u=this._events[o],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,s),!0;case 4:return u.fn.call(u.context,t,s,i),!0;case 5:return u.fn.call(u.context,t,s,i,r),!0;case 6:return u.fn.call(u.context,t,s,i,r,a),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var d,f=u.length;for(c=0;c<f;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,s);break;case 4:u[c].fn.call(u[c].context,t,s,i);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];u[c].fn.apply(u[c].context,l)}}return!0},o.prototype.on=function(e,t,n){return r(this,e,t,n,!1)},o.prototype.once=function(e,t,n){return r(this,e,t,n,!0)},o.prototype.removeListener=function(e,t,s,i){var r=n?n+e:e;if(!this._events[r])return this;if(!t)return a(this,r),this;var o=this._events[r];if(o.fn)o.fn!==t||i&&!o.once||s&&o.context!==s||a(this,r);else{for(var l=0,c=[],u=o.length;l<u;l++)(o[l].fn!==t||i&&!o[l].once||s&&o[l].context!==s)&&c.push(o[l]);c.length?this._events[r]=1===c.length?c[0]:c:a(this,r)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,e.exports=o})),p={code:"100",message:"未知错误"},v={code:"101",message:"disconnect failed"},g={code:"102",message:"signal is null"},m={code:"103",message:"channelInfo is null"},y={code:"104",message:"client is null"},I={code:"105",message:"stream is null"},b={code:"106",message:"callType is null"},w={code:"107",message:"invite all failed"},C={code:"109",message:"groupInvite part failed"},S={code:"110",message:"cancel part failed"},T={code:"111",message:"signal leave failed"},j={code:"112",message:"G2 RTC leave failed"},P={code:"113",message:"durations is empty"},_={code:"114",message:"deviceId is null"};!function(e){e[e.idle=0]="idle",e[e.calling=1]="calling",e[e.called=2]="called",e[e.inCall=3]="inCall"}(d||(d={}));var M="0.0.2",E=function(){return Math.ceil(1e5*Math.random())+""},k=function(e){function t(t){var n=(void 0===t?{debug:!0}:t).debug,s=void 0===n||n,i=e.call(this)||this;return i.log=null,i.debug=!0,i.localStream=null,i.remoteStreams=[],i.localView=void 0,i.remoteViews=[],i.client=null,i.signal=null,i.isConnect=!1,i.channelInfo=null,i.callingUserIds=[],i.requestId="",i.callType=null,i.appKey="",i.uid=E(),i.invitorChannelInfo=null,i.isGroupCall=!1,i.callStatus=d.idle,i.durations=[],i.userMap={},i.microphoneId="",i.cameraId="",i.speakerId="",i.audioEnabled=!1,i.videoEnabled=!1,i.callTimeout=void 0,i.rejectTimeout=void 0,i.getTokenFunc=null,i.debug=s,i.log=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(e){var s=new Date,i=s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate()+" "+s.getHours()+":"+s.getMinutes()+":"+s.getSeconds();console.log.apply(console,h(["[NRTCCalling Message 0.0.2 "+i+"]: "],t))}}}(s),i}return function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.setupAppKey=function(e){var t=e.appKey;this.client||(this.appKey=t,this.client=i.default.createClient({appkey:this.appKey,debug:this.debug}),this.log("setupAppKey success"))},t.prototype.login=function(e){var t=this;return new Promise((function(n,s){t.signal=r.default.NIM.getInstance({appKey:t.appKey,account:e.account,token:e.token,debug:t.debug,onconnect:function(){var s;t.log("login success"),t.isConnect=!0,t.userMap[t.uid]=e.account,t.addEventListener(),t.signal.signalingSync(),null===(s=e.success)||void 0===s||s.call(e),n()},onerror:function(n){var i;t.log("login fail:",n),null===(i=e.failed)||void 0===i||i.call(e,n),s(n)}})}))},t.prototype.logout=function(e){var t,n;return l(this,void 0,void 0,(function(){var s;return c(this,(function(i){switch(i.label){case 0:if(i.trys.push([0,2,,3]),!this.isConnect)throw v;if(!this.signal)throw g;return[4,this.signal.disconnect()];case 1:return i.sent(),delete this.userMap[this.uid],this.log("logout success"),null===(t=null==e?void 0:e.success)||void 0===t||t.call(e),[3,3];case 2:return s=i.sent(),this.log("logout fail:",s),null===(n=null==e?void 0:e.failed)||void 0===n||n.call(e,v),[2,Promise.reject(v)];case 3:return[2]}}))}))},t.prototype.call=function(e){var t,n;return l(this,void 0,void 0,(function(){var s,i,r=this;return c(this,(function(a){switch(a.label){case 0:if(a.trys.push([0,5,,6]),!this.signal)throw g;if(!this.client)throw y;return this.channelInfo?[3,3]:[4,this.signalCreate({type:e.type})];case 1:return s=a.sent(),[4,this.signal.signalingJoin({channelId:s.channelId,offlineEnabled:!0,uid:this.uid})];case 2:a.sent(),this.log("signalingJoin success！"),a.label=3;case 3:return this.callStatus=d.calling,this.isGroupCall=!1,this.durations=[{accid:this.userMap[this.uid],duration:Date.now()}],this.callingUserIds=[e.userId],this.requestId=E(),[4,this.signalInvite(e.userId)];case 4:return a.sent(),this.log("call success"),null===(t=e.success)||void 0===t||t.call(e),void 0!==this.callTimeout&&setTimeout((function(){return l(r,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:if(this.callStatus!==d.calling)return[3,7];n.label=1;case 1:return n.trys.push([1,3,4,7]),[4,this.signalCancel()];case 2:return n.sent(),this.log("signalInvite timeout cancel success",this.callTimeout),[3,7];case 3:return t=n.sent(),this.log("signalInvite timeout cancel fail: ",t,this.callTimeout),[3,7];case 4:return this.emit("onCallingTimeOut"),[4,this.sendMessage(e.userId,"timeout")];case 5:return n.sent(),[4,this.destroy()];case 6:return n.sent(),[7];case 7:return[2]}}))}))}),this.callTimeout),[3,6];case 5:return i=a.sent(),this.log("call fail:",i),null===(n=e.failed)||void 0===n||n.call(e,i),[2,Promise.reject(i)];case 6:return[2]}}))}))},t.prototype.groupCall=function(e){var t,n;return l(this,void 0,void 0,(function(){var s,i=this;return c(this,(function(r){switch(r.label){case 0:if(r.trys.push([0,5,,6]),!this.signal)throw g;if(!this.client)throw y;return this.channelInfo?[3,3]:[4,this.signalCreate({type:e.type})];case 1:return r.sent(),[4,this.joinSignalAndRTC()];case 2:r.sent(),r.label=3;case 3:return this.callStatus=d.calling,this.isGroupCall=!0,this.callingUserIds=h(e.userIds),this.requestId=E(),[4,this.signalGroupInvite({userIds:e.userIds,groupId:e.groupId})];case 4:return r.sent(),this.log("groupCall success"),null===(t=e.success)||void 0===t||t.call(e),void 0!==this.callTimeout&&setTimeout((function(){return l(i,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:if(this.callStatus!==d.calling)return[3,6];t.label=1;case 1:return t.trys.push([1,3,4,6]),[4,Promise.all([this.signalCancel(),this.rTCLeave()])];case 2:return t.sent(),this.log("signalGroupInvite timeout cancel success",this.callStatus),[3,6];case 3:return e=t.sent(),this.log("signalGroupInvite timeout cancel fail: ",e,this.callStatus),[3,6];case 4:return this.emit("onCallingTimeOut"),[4,this.destroy()];case 5:return t.sent(),[7];case 6:return[2]}}))}))}),this.callTimeout),[3,6];case 5:return s=r.sent(),this.log("groupCall fail",s),null===(n=e.failed)||void 0===n||n.call(e,s),[2,Promise.reject(s)];case 6:return[2]}}))}))},t.prototype.addDelegate=function(e,t){this.on(e,t)},t.prototype.removeDelegate=function(e){this.off(e)},t.prototype.cancel=function(e){var t,n;return l(this,void 0,void 0,(function(){var s,i,r=this;return c(this,(function(a){switch(a.label){case 0:if(a.trys.push([0,5,,6]),!this.signal)throw g;if(!this.channelInfo)throw m;return[4,this.signalCancel()];case 1:return a.sent(),this.isGroupCall?[3,4]:(s=this.callingUserIds.find((function(e){return e!==r.userMap[r.uid]}))||"",[4,this.sendMessage(s,"canceled")]);case 2:return a.sent(),[4,this.destroy()];case 3:a.sent(),a.label=4;case 4:return this.log("cancel success"),null===(t=null==e?void 0:e.success)||void 0===t||t.call(e),[3,6];case 5:return i=a.sent(),this.log("cancel fail",i),null===(n=null==e?void 0:e.failed)||void 0===n||n.call(e,i),[2,Promise.reject(i)];case 6:return[2]}}))}))},t.prototype.accept=function(e){var t,n;return l(this,void 0,void 0,(function(){var s;return c(this,(function(i){switch(i.label){case 0:if(i.trys.push([0,2,,3]),!this.signal)throw g;if(!this.invitorChannelInfo)throw m;if(!this.client)throw y;return[4,this.acceptSignal()];case 1:return i.sent(),this.callStatus=d.inCall,this.log("accept success"),null===(t=null==e?void 0:e.success)||void 0===t||t.call(e),[3,3];case 2:return s=i.sent(),this.log("accept fail:",s),null===(n=null==e?void 0:e.failed)||void 0===n||n.call(e,s),[2,Promise.reject(s)];case 3:return[2]}}))}))},t.prototype.reject=function(e){var t,n;return l(this,void 0,void 0,(function(){var s;return c(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.rejectCall(!1)];case 1:return i.sent(),this.log("reject success"),null===(t=null==e?void 0:e.success)||void 0===t||t.call(e),[3,3];case 2:return s=i.sent(),this.log("reject fail:",s),null===(n=null==e?void 0:e.failed)||void 0===n||n.call(e,s),[2,Promise.reject(s)];case 3:return[2]}}))}))},t.prototype.leave=function(e){var t,n;return l(this,void 0,void 0,(function(){var s,i,r=this;return c(this,(function(a){switch(a.label){case 0:if(a.trys.push([0,4,,5]),!this.signal)throw g;if(!this.channelInfo)throw m;if(!this.client)throw y;return this.isGroupCall?[3,2]:(s=Object.values(this.userMap).find((function(e){return e!==r.userMap[r.uid]}))||"",[4,this.sendMessage(s,"complete")]);case 1:a.sent(),a.label=2;case 2:return[4,Promise.all([this.signalLeave(),this.rTCLeave()])];case 3:return a.sent(),this.log("leave success"),null===(t=null==e?void 0:e.success)||void 0===t||t.call(e),[3,5];case 4:return i=a.sent(),this.log("leave fail:",i),null===(n=null==e?void 0:e.failed)||void 0===n||n.call(e,i),[2,Promise.reject(i)];case 5:return[2]}}))}))},t.prototype.hangup=function(e){var t,n;return l(this,void 0,void 0,(function(){var s,i,r=this;return c(this,(function(a){switch(a.label){case 0:if(a.trys.push([0,5,,6]),!this.signal)throw g;if(!this.channelInfo)throw m;return[4,Promise.all([this.signalCancel(),this.rTCLeave()])];case 1:return a.sent(),this.isGroupCall?[3,3]:(s=Object.values(this.userMap).find((function(e){return e!==r.userMap[r.uid]}))||"",[4,this.sendMessage(s,"complete")]);case 2:a.sent(),a.label=3;case 3:return[4,this.destroy()];case 4:return a.sent(),this.log("hangup success"),null===(t=null==e?void 0:e.success)||void 0===t||t.call(e),[3,6];case 5:return i=a.sent(),this.log("hangup fail:",i),null===(n=null==e?void 0:e.failed)||void 0===n||n.call(e,i),[2,Promise.reject(i)];case 6:return[2]}}))}))},t.prototype.setTokenService=function(e){this.getTokenFunc=e},t.prototype.setCallTimeout=function(e){this.callTimeout=this.rejectTimeout=e},t.prototype.setupLocalView=function(e){e&&(this.localView=e,this.log("setupLocalView set view success",e))},t.prototype.setupRemoteView=function(e,t){this.remoteViews.every((function(t){return t.userId!==e}))?this.remoteViews.push({userId:e,view:t}):this.remoteViews=this.remoteViews.map((function(n){return n.userId===e?o(o({},n),{view:t}):o({},n)}))},t.prototype.enableLocalVideo=function(e){return this._enableLocalVideo(e)},t.prototype.muteLocalAudio=function(e){return this._muteLocalAudio(e)},t.prototype.selectSpeakers=function(e){var t;return l(this,void 0,void 0,(function(){var n,s,i,r,a,o;return c(this,(function(l){switch(l.label){case 0:if(l.trys.push([0,5,,6]),!this.client)throw y;if(!(n=null===(t=this.client.adapterRef)||void 0===t?void 0:t.audioHelperMap))throw p;if(!e)throw _;for(i in s=[],n)s.push(i);r=0,l.label=1;case 1:return r<s.length?(a=s[r],n[a]&&n[a].audioDomHelper&&n[a].audioDomHelper.audioDom?[4,this._selectSpeakers(n[a].audioDomHelper.audioDom,e)]:[3,3]):[3,4];case 2:l.sent(),l.label=3;case 3:return r++,[3,1];case 4:return this.log("selectSpeakers success",e),[3,6];case 5:return o=l.sent(),this.log("selectSpeakers fail: ",o,e),[2,Promise.reject(o)];case 6:return[2]}}))}))},t.prototype.getDevices=function(){return l(this,void 0,void 0,(function(){var e,t,n,s,r,a,l=this;return c(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,i.default.getDevices()];case 1:for(r in e=c.sent(),t={audioIn:"microphoneId",audioOut:"speakerId",video:"cameraId"},n={},s=function(s){e.hasOwnProperty(s)&&(n[s]=e[s].map((function(e){return l[t[s]]===e.deviceId?o(o({},e),{active:!0}):o({},e)})))},e)s(r);return this.log("getDevices success",n),[2,n];case 2:return a=c.sent(),this.log("getDevices fail: ",a),[2,Promise.reject(a)];case 3:return[2]}}))}))},t.prototype.switchDevice=function(e,t){return l(this,void 0,void 0,(function(){var n;return c(this,(function(s){switch(s.label){case 0:switch(s.trys.push([0,8,,9]),e){case"microphoneId":return[3,1];case"cameraId":return[3,3];case"speakerId":return[3,5]}return[3,7];case 1:return this.microphoneId===t?[2,Promise.resolve()]:[4,this._muteLocalAudio(this.audioEnabled,t)];case 2:return s.sent(),[3,7];case 3:return this.cameraId===t?[2,Promise.resolve()]:[4,this._enableLocalVideo(this.videoEnabled,t)];case 4:return s.sent(),[3,7];case 5:return this.speakerId===t?[2,Promise.resolve()]:[4,this.selectSpeakers(t)];case 6:return s.sent(),[3,7];case 7:return this.log("switchDevice success",e,t),[3,9];case 8:return n=s.sent(),this.log("switchDevice fail: ",n,e,t),[2,Promise.reject(n)];case 9:return[2]}}))}))},t.prototype.switchCallType=function(e){return l(this,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:if(n.trys.push([0,3,,4]),1!==e)throw"sorry，目前仅支持视频切换为音频";if(!this.signal)throw g;if(!this.channelInfo)throw m;return[4,this._enableLocalVideo(!1)];case 1:return n.sent(),[4,this.signal.signalingControl({channelId:this.channelInfo.channelId,account:"",attachExt:JSON.stringify({cid:2})})];case 2:return n.sent(),this.log("switchCallType success"),[3,4];case 3:return t=n.sent(),this.log("switchCallType fail: ",t),[2,Promise.reject(t)];case 4:return[2]}}))}))},t.prototype.setAudioMute=function(e,t){return l(this,void 0,void 0,(function(){var n,s,i,r=this;return c(this,(function(a){switch(a.label){case 0:if(n="",Object.keys(this.userMap).forEach((function(e){r.userMap[e]===t&&(n=e)})),!n)return this.log("setAudioMute fail: userId is invalid",this.userMap),[2];if(!(s=this.remoteStreams.find((function(e){return e.getId()===n}))))return this.log("setAudioMute fail: stream is not exist",n),[2];a.label=1;case 1:return a.trys.push([1,6,,7]),e?[4,s.muteAudio()]:[3,3];case 2:return a.sent(),[3,5];case 3:return[4,s.unmuteAudio()];case 4:a.sent(),a.label=5;case 5:return this.log("setAudioMute success",e,s),[3,7];case 6:return i=a.sent(),this.log("setAudioMute fail: ",i),[2,Promise.reject(i)];case 7:return[2]}}))}))},t.prototype.getRoomInfo=function(){return l(this,void 0,void 0,(function(){var e,t;return c(this,(function(n){switch(n.label){case 0:if(n.trys.push([0,2,,3]),!this.channelInfo)throw m;if(!this.signal)throw g;return[4,this.signal.signalingGetChannelInfo({channelName:this.channelInfo.channelName})];case 1:return e=n.sent(),this.log("getRoomInfo success"),[2,o(o({},e),{uid:this.uid})];case 2:return t=n.sent(),this.log("getRoomInfo fail: ",t),[2,Promise.reject(t)];case 3:return[2]}}))}))},t.prototype.getSdkInstance=function(){return{signal:this.signal,rtcClient:this.client,WebRTC2:i.default}},t.prototype.signalCreate=function(e){var t=e.type;return l(this,void 0,void 0,(function(){var e,n;return c(this,(function(s){switch(s.label){case 0:this.callType||(this.callType=t),s.label=1;case 1:return s.trys.push([1,3,,4]),e=this,[4,this.signal.signalingCreate({type:t})];case 2:return e.channelInfo=s.sent(),this.log("signalingCreate Success","channelInfo:",this.channelInfo,"callType:",this.callType),[2,this.channelInfo];case 3:return n=s.sent(),this.log("signalingCreate failed:",n,"callType:",this.callType),[2,Promise.reject(n)];case 4:return[2]}}))}))},t.prototype.signalInvite=function(e){return l(this,void 0,void 0,(function(){var t,n,s,i;return c(this,(function(r){switch(r.label){case 0:if(!this.channelInfo)return[2,Promise.reject(m)];r.label=1;case 1:r.trys.push([1,6,,8]),t=JSON.stringify({callType:0}),n={channelId:this.channelInfo.channelId,offlineEnabled:!0,account:e,requestId:this.requestId,pushInfo:{pushTitle:"邀请通知",pushContent:"你收到了邀请",pushPayload:{},needPush:!0,needBadge:!0},attachExt:t},this.log("signalingInvite in call",n),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this.signal.signalingInvite(n)];case 3:return r.sent(),[3,5];case 4:if(s=r.sent(),!/OFFLINE/i.test(null==s?void 0:s.message))throw s;return[3,5];case 5:return this.log("signalInvite success！"),[3,8];case 6:return i=r.sent(),this.log("signalInvite fail:",{channelId:this.channelInfo.channelId,requestId:this.requestId},i),this.callingUserIds=this.callingUserIds.filter((function(t){return t!==e})),[4,this.destroy()];case 7:return r.sent(),[2,Promise.reject(i)];case 8:return[2]}}))}))},t.prototype.signalGroupInvite=function(e){return l(this,void 0,void 0,(function(){var t,n,s,i=this;return c(this,(function(r){switch(r.label){case 0:return this.channelInfo?(t=JSON.stringify({callType:1,callUserList:this.callingUserIds,groupID:void 0===e.groupId?null:e.groupId}),[4,Promise.allSettled(e.userIds.map((function(e){var n={channelId:i.channelInfo.channelId,offlineEnabled:!0,account:e,requestId:i.requestId,pushInfo:{pushTitle:"邀请通知",pushContent:"你收到了邀请",pushPayload:{},needPush:!0,needBadge:!0},attachExt:t};return i.log("signalingInvite in groupCall",n),i.signal.signalingInvite(n).then((function(){return Promise.resolve()})).catch((function(e){return/OFFLINE/i.test(null==e?void 0:e.message)?Promise.resolve():Promise.reject(e)}))})))]):[2,Promise.reject(m)];case 1:return(n=r.sent()).every((function(e){return"rejected"===e.status}))?(this.log("signalGroupInvite fail",n),[4,this.destroy()]):[3,3];case 2:return r.sent(),[2,Promise.reject(w)];case 3:return(s=e.userIds.filter((function(e,t){return"rejected"===n[t].status}))).length&&(this.log("signalGroupInvite part fail:",s),this.emit("onError",C,s)),this.callingUserIds=this.callingUserIds.filter((function(e){return!s.includes(e)})),this.log("signalGroupInvite success"),[2,Promise.resolve()]}}))}))},t.prototype.signalCancel=function(){return l(this,void 0,void 0,(function(){var e,t,n=this;return c(this,(function(s){switch(s.label){case 0:return[4,Promise.allSettled(this.callingUserIds.map((function(e){return n.signal.signalingCancel({channelId:n.channelInfo.channelId,account:e,requestId:n.requestId,offlineEnabled:!0})})))];case 1:return e=s.sent(),this.callStatus=d.idle,(t=this.callingUserIds.filter((function(t,n){return"rejected"===e[n].status}))).length&&(this.log("signalCancel part fail:",t),this.emit("onError",S,t)),this.callingUserIds=[],this.log("signalCancel success"),[2,Promise.resolve()]}}))}))},t.prototype.signalLeave=function(){return l(this,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,3,4]),[4,this.signal.signalingLeave({channelId:this.channelInfo.channelId,offlineEnabled:!0})];case 1:return t.sent(),this.log("signalLeave success"),[3,4];case 2:return e=t.sent(),this.log("signalLeave fail but resolve:",e),this.emit("onError",T),[3,4];case 3:return this.resetChannel(),[2,Promise.resolve()];case 4:return[2]}}))}))},t.prototype.signalClose=function(){return l(this,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:if(t.trys.push([0,2,3,4]),!this.signal)throw g;if(!this.channelInfo)throw m;return[4,this.signal.signalingClose({channelId:this.channelInfo.channelId,offlineEnabled:!0})];case 1:return t.sent(),this.log("signalClose success"),[3,4];case 2:return e=t.sent(),this.log("signalClose fail but resolve:",this.channelInfo,e),[3,4];case 3:return[2,Promise.resolve()];case 4:return[2]}}))}))},t.prototype.joinSignalAndRTC=function(){return l(this,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:if(!this.channelInfo)return[2,Promise.reject(m)];if(!this.callType)return[2,Promise.reject(b)];t.label=1;case 1:return t.trys.push([1,4,,5]),[4,this.signal.signalingJoin({channelId:this.channelInfo.channelId,offlineEnabled:!0,uid:this.uid})];case 2:return t.sent(),[4,this.joinRTCChannel()];case 3:return t.sent(),this.log("joinSignalAndRTC success"),[3,5];case 4:return e=t.sent(),this.log("joinSignalAndRTC fail:",e),this.destroy(),[2,Promise.reject(e)];case 5:return[2]}}))}))},t.prototype.acceptSignal=function(){return l(this,void 0,void 0,(function(){var e,t,n=this;return c(this,(function(s){switch(s.label){case 0:return s.trys.push([0,4,,5]),[4,this.signal.signalingAccept({channelId:this.invitorChannelInfo.channelId,account:this.invitorChannelInfo.from,requestId:this.invitorChannelInfo.requestId,offlineEnabled:!0,autoJoin:!0,uid:this.uid})];case 1:return e=s.sent(),this.log("signalingAccept success"),this.channelInfo=e,this.callType=this.invitorChannelInfo.type,e.members.forEach((function(e){n.userMap[e.uid]||(n.userMap[e.uid]=e.accid)})),this.invitorChannelInfo=null,this.log("acceptSignal success",e),this.isGroupCall?[4,this.joinRTCChannel()]:[3,3];case 2:s.sent(),s.label=3;case 3:return[3,5];case 4:return t=s.sent(),this.log("acceptSignal fail:",t),this.destroy(),[2,Promise.reject(t)];case 5:return[2]}}))}))},t.prototype.rtcSubscribe=function(e,t){return l(this,void 0,void 0,(function(){var n;return c(this,(function(s){switch(s.label){case 0:e.setSubscribeConfig(t),s.label=1;case 1:if(s.trys.push([1,3,,4]),!this.client)throw y;return[4,this.client.subscribe(e)];case 2:return s.sent(),this.log("rtcSubscribe success"),[3,4];case 3:return n=s.sent(),this.log("rtcSubscribe fail:",n),[2,Promise.reject(n)];case 4:return[2]}}))}))},t.prototype.rtcUnSubscribe=function(e,t){return l(this,void 0,void 0,(function(){var n;return c(this,(function(s){switch(s.label){case 0:e.setSubscribeConfig(t),s.label=1;case 1:if(s.trys.push([1,3,,4]),!this.client)throw y;return[4,this.client.unsubscribe(e)];case 2:return s.sent(),this.log("rtcUnSubscribe success"),[3,4];case 3:return n=s.sent(),this.log("rtcUnSubscribe fail:",n),[2,Promise.reject(n)];case 4:return[2]}}))}))},t.prototype.rTCLeave=function(){return l(this,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,3,4]),[4,this.client.leave()];case 1:return t.sent(),this.log("rTCLeave success"),[3,4];case 2:return e=t.sent(),this.log("rTCLeave fail but resolve:",e),this.emit("onError",j),[3,4];case 3:return[2,Promise.resolve()];case 4:return[2]}}))}))},t.prototype.joinRTCChannel=function(){return l(this,void 0,void 0,(function(){var e,t;return c(this,(function(n){switch(n.label){case 0:if(n.trys.push([0,6,,7]),!this.channelInfo)throw m;return e="",this.getTokenFunc?[4,this.getTokenFunc(this.uid)]:[3,2];case 1:e=n.sent(),n.label=2;case 2:return[4,this.client.join({channelName:this.channelInfo.channelId,uid:this.uid,token:e})];case 3:return n.sent(),[4,this.initLocalStream()];case 4:return n.sent(),[4,this.client.publish(this.localStream)];case 5:return n.sent(),this.log("joinRTCChannel success"),[3,7];case 6:return t=n.sent(),this.log("joinRTCChannel fail:",t),[2,Promise.reject(t)];case 7:return[2]}}))}))},t.prototype.initLocalStream=function(){var e,t,n;return l(this,void 0,void 0,(function(){var s,r,a,o,l;return c(this,(function(c){switch(c.label){case 0:return c.trys.push([0,4,,5]),this.localStream=i.default.createStream({uid:this.uid,audio:!0,video:2===this.callType,screen:!1}),this.log("localStream create success"),this.localStream.setVideoProfile({resolution:i.default.VIDEO_QUALITY_720p,frameRate:i.default.CHAT_VIDEO_FRAME_RATE_15}),this.localStream.setAudioProfile("speech_low_quality"),[4,this.localStream.init()];case 1:return c.sent(),this.log("localStream init success"),[4,this.getDevices()];case 2:return s=c.sent(),r=s.audioIn,a=s.audioOut,o=s.video,this.microphoneId=(null===(e=r[0])||void 0===e?void 0:e.deviceId)||"",this.cameraId=(null===(t=o[0])||void 0===t?void 0:t.deviceId)||"",this.speakerId=(null===(n=a[0])||void 0===n?void 0:n.deviceId)||"",[4,this.startStreamPreview(this.localStream,"local",this.localView)];case 3:return c.sent(),this.log("startLocalStreamPreview success",this.localStream,this.localView),this.log("initLocalStream success"),[3,5];case 4:return l=c.sent(),this.log("initLocalStream fail:",l),[2,Promise.reject(l)];case 5:return[2]}}))}))},t.prototype.startStreamPreview=function(e,t,n){return l(this,void 0,void 0,(function(){var s,i;return c(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.play(n)];case 1:return r.sent(),this.log("startStreamPreview success",{stream:e,type:t,view:n}),n&&(s={width:n.clientWidth,height:n.clientHeight,cut:!0},e["local"===t?"setLocalRenderMode":"setRemoteRenderMode"](s),this.log("setLocalRenderMode success",{params:s,type:t})),[3,3];case 2:return i=r.sent(),this.log("startStreamPreview fail: ",i),[2,Promise.reject(i)];case 3:return[2]}}))}))},t.prototype.rejectCall=function(e){return void 0===e&&(e=!1),l(this,void 0,void 0,(function(){var t,n;return c(this,(function(s){switch(s.label){case 0:if(s.trys.push([0,2,3,4]),!this.signal)throw g;if(!this.invitorChannelInfo)throw m;return t={channelId:this.invitorChannelInfo.channelId,account:this.invitorChannelInfo.from,requestId:this.invitorChannelInfo.requestId,offlineEnabled:!0},e&&(t.attachExt="601"),[4,this.signal.signalingReject(t)];case 1:return s.sent(),this.invitorChannelInfo=null,this.log("rejectCall success"),[3,4];case 2:return n=s.sent(),this.log("rejectCall fail:",this.invitorChannelInfo,n),[2,Promise.reject(n)];case 3:return this.callStatus=d.idle,[7];case 4:return[2]}}))}))},t.prototype.filterCallingUserByMembers=function(e){void 0===e&&(e=[]),this.log("filterCallingUserByMembers:",e),this.callingUserIds=this.callingUserIds.filter((function(t){return e.every((function(e){return e.account!==t}))}))},t.prototype.sendMessage=function(e,t){var n=this;return new Promise((function(s,i){if(!n.signal)return i(g);if(!n.callType)return i(b);if(!n.channelInfo)return i(m);if(!n.durations.length)return i(P);if(!e)return i("to is invalid");var r={type:n.callType,channelId:n.channelInfo.channelId,status:{complete:1,canceled:2,rejected:3,timeout:4,busy:5}[t],durations:n.durations.map((function(e){return o(o({},e),{duration:e.duration?Date.now()-e.duration:null})}))};n.signal.sendG2Msg({attach:r,scene:"p2p",to:e,done:function(e){if(e)return n.log("sendMessage fail:",r,e),i(e);n.log("sendMessage success",r),s()}})}))},t.prototype._enableLocalVideo=function(e,t){return l(this,void 0,void 0,(function(){var n;return c(this,(function(s){switch(s.label){case 0:if(s.trys.push([0,4,,5]),!this.localStream)throw I;return[4,this.localStream[e?"open":"close"]({type:"video",deviceId:t})];case 1:return s.sent(),this.videoEnabled=e,t&&(this.cameraId=t),e?[4,this.startStreamPreview(this.localStream,"local",this.localView)]:[3,3];case 2:s.sent(),s.label=3;case 3:return this.log("_enableLocalVideo success:",e,t),[3,5];case 4:return n=s.sent(),this.log("_enableLocalVideo fail:",e,t,n),[2,Promise.reject(n)];case 5:return[2]}}))}))},t.prototype._muteLocalAudio=function(e,t){return l(this,void 0,void 0,(function(){var n;return c(this,(function(s){switch(s.label){case 0:if(s.trys.push([0,2,,3]),!this.localStream)throw I;return[4,this.localStream[e?"close":"open"]({type:"audio",deviceId:t})];case 1:return s.sent(),this.audioEnabled=!e,t&&(this.microphoneId=t),this.log("_muteLocalAudio success:",e,t),[3,3];case 2:return n=s.sent(),this.log("_muteLocalAudio fail:",e,t,n),[2,Promise.reject(n)];case 3:return[2]}}))}))},t.prototype._selectSpeakers=function(e,t){return l(this,void 0,void 0,(function(){var n;return c(this,(function(s){switch(s.label){case 0:if(e&&void 0===e.sinkId)return[2];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,e.setSinkId(t)];case 2:return s.sent(),this.speakerId=t,[3,4];case 3:return n=s.sent(),[2,Promise.reject(n)];case 4:return[2]}}))}))},t.prototype.resetChannel=function(){var e=this;this.localStream=null,this.remoteStreams=[],this.localView=void 0,this.remoteViews=[],this.audioEnabled=!1,this.videoEnabled=!1,this.microphoneId="",this.cameraId="",this.speakerId="",this.channelInfo=null,this.callingUserIds=[],this.requestId="",this.callType=null,this.invitorChannelInfo=null,this.isGroupCall=!1,this.callStatus=d.idle,this.durations=[],Object.keys(this.userMap).forEach((function(t){t!==e.uid&&delete e.userMap[t]})),this.log("resetChannel success")},t.prototype.destroy=function(){return l(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,Promise.all([this.signalClose(),this.rTCLeave()])];case 1:return e.sent(),this.resetChannel(),this.log("destroy success"),[2]}}))}))},t.prototype.addEventListener=function(){var e=this;this.signal.on("signalingNotify",(function(t){switch(t.eventType){case"ROOM_JOIN":e.signalRoomJoinHandler(t);break;case"ROOM_CLOSE":e.roomCloseHandler(t);break;case"INVITE":e.inviteHandler(t);break;case"CANCEL_INVITE":e.cancelInviteHandler(t);break;case"REJECT":e.rejectHandler(t);break;case"ACCEPT":e.acceptHandler(t);break;case"CONTROL":e.controlHandler(t)}})),this.signal.on("signalingMutilClientSyncNotify",(function(t){return l(e,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:switch(t.eventType){case"REJECT":return[3,1];case"ACCEPT":return[3,3]}return[3,5];case 1:return[4,this.rejectHandler(t)];case 2:return e.sent(),[3,5];case 3:return[4,this.acceptHandler(t)];case 4:return e.sent(),[3,5];case 5:return[2]}}))}))})),this.signal.on("signalingUnreadMessageSyncNotify",(function(t){return l(e,void 0,void 0,(function(){var e,n,s;return c(this,(function(i){switch(i.label){case 0:return this.log("signalingUnreadMessageSyncNotify",t),e=t.filter((function(e){return!e.channelInValid})),n=e.filter((function(e){return"REJECT"===e.eventType})),(s=e.filter((function(e){return"INVITE"===e.eventType})).sort((function(e,t){return t.channelCreateTime-e.channelCreateTime})))[0]&&n.every((function(e){return e.requestId!==s[0].requestId}))?[4,this.inviteHandler(s[0])]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))})),this.client.on("peer-online",(function(t){e.roomJoinHandler(t)})),this.client.on("peer-leave",(function(t){e.leaveHandler(t)})),this.client.on("stream-added",(function(t){return l(e,void 0,void 0,(function(){var e,n,s;return c(this,(function(i){switch(i.label){case 0:this.log("stream-added:",t),e=t.stream,n=e.getId(),this.remoteStreams.some((function(e){return e.getId()===n}))?(this.log("stream-added：订阅的流已存在，更新流"),this.remoteStreams=this.remoteStreams.map((function(t){return t.getId()===n?e:t}))):(this.log("stream-added：新增需要订阅的流"),this.remoteStreams.push(e)),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.rtcSubscribe(e,{audio:!0,video:!0})];case 2:return i.sent(),[3,4];case 3:return s=i.sent(),this.log("stream-added fail: ",s),[3,4];case 4:return[2]}}))}))})),this.client.on("stream-removed",(function(t){e.log("stream-removed:","callType:",e.callType,t);var n=t.stream,s=n.getId();n.stop(),e.log("stream-removed：停止订阅流，更新流"),e.remoteStreams=e.remoteStreams.map((function(e){return e.getId()===s?n:e}));var i=e.userMap[s];e.emit("onAudioAvailable",{userId:i,uid:s,available:n.audio}),2===e.callType&&e.emit("onCameraAvailable",{userId:i,uid:s,available:n.video})})),this.client.on("stream-subscribed",(function(t){return l(e,void 0,void 0,(function(){var e,n,s,i,r;return c(this,(function(a){switch(a.label){case 0:this.log("stream-subscribed:","callType:",this.callType,t),e=t.stream,n=e.getId(),s=this.userMap[n],this.emit("onAudioAvailable",{userId:s,uid:n,available:e.audio}),2===this.callType&&this.emit("onCameraAvailable",{userId:s,uid:n,available:e.video}),i=(this.remoteViews.find((function(e){return e.userId===s}))||{view:void 0}).view,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.startStreamPreview(e,"remote",i)];case 2:return a.sent(),this.log("startRemoteStreamPreview success",e,i),[3,4];case 3:return r=a.sent(),this.log("startRemoteStreamPreview fail: ",e,i,r),[3,4];case 4:return[2]}}))}))})),this.client.on("network-quality",(function(t){var n={};t.forEach((function(t){var s=e.userMap[t.uid];s&&(n[s]={uplinkNetworkQuality:t.uplinkNetworkQuality,downlinkNetworkQuality:t.downlinkNetworkQuality})})),e.emit("onUserNetworkQuality",n)}))},t.prototype.signalRoomJoinHandler=function(e){var t;this.log("signalRoomJoinHandler:",e);try{t=JSON.parse(e.attach)}catch(e){t={}}var n=(t.member||{})[2];this.filterCallingUserByMembers([{uid:n,account:e.from}]),this.userMap[n]=e.from},t.prototype.roomCloseHandler=function(e){return l(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return this.log("roomCloseHandler:",e),[4,this.destroy()];case 1:return t.sent(),this.emit("onCallEnd"),[2]}}))}))},t.prototype.roomJoinHandler=function(e){var t=this.userMap[e.uid];this.log("roomJoinHandler:",t,e),this.emit("onUserEnter",t)},t.prototype.acceptHandler=function(e){return l(this,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:if(this.callStatus=d.inCall,this.emit("onUserAccept",e.from),this.isGroupCall)return this.log("acceptHandler from group:",e),[2,Promise.resolve()];n.label=1;case 1:if(n.trys.push([1,4,,5]),!this.channelInfo)throw m;if(!this.callType)throw b;if(!this.signal)throw g;return[4,this.joinRTCChannel()];case 2:return n.sent(),this.durations.push({accid:e.from,duration:Date.now()}),[4,this.signal.signalingControl({channelId:this.channelInfo.channelId,account:e.from,attachExt:JSON.stringify({cid:1})})];case 3:return n.sent(),this.log("acceptHandler from signal success:",e),[3,5];case 4:return t=n.sent(),this.log("acceptHandler from signal fail:",e,t),this.emit("onError",t),[3,5];case 5:return[2]}}))}))},t.prototype.inviteHandler=function(e){return l(this,void 0,void 0,(function(){var t,n,s,i=this;return c(this,(function(r){switch(r.label){case 0:if(e.channelInValid)return[2];this.log("inviteHandler:","callStatus:",this.callStatus,e);try{t=JSON.parse(e.attachExt)}catch(e){t={}}if(n=Number(e.type),this.invitorChannelInfo={channelId:e.channelId,channelName:e.channelName,creatorId:e.creator,requestId:e.requestId,from:e.from,type:n},this.callStatus===d.idle)return[3,5];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.rejectCall(!0)];case 2:return r.sent(),[3,4];case 3:return s=r.sent(),this.log("reject error in inviteHandler: ",s),[3,4];case 4:return[2];case 5:return this.callStatus=d.called,this.isGroupCall=t.callType+""=="1",this.emit("onInvited",{invitor:e.from,userIds:t.callUserList,isFromGroup:this.isGroupCall,groupId:t.groupID,type:n}),void 0!==this.rejectTimeout&&setTimeout((function(){return l(i,void 0,void 0,(function(){var e;return c(this,(function(t){switch(t.label){case 0:if(this.callStatus!==d.called)return[3,5];t.label=1;case 1:return t.trys.push([1,3,4,5]),[4,this.rejectCall(!1)];case 2:return t.sent(),this.log("reject timeout success",this.rejectTimeout),[3,5];case 3:return e=t.sent(),this.log("reject timeout fail: ",e,this.rejectTimeout),[3,5];case 4:return this.emit("onCallingTimeOut"),[7];case 5:return[2]}}))}))}),this.rejectTimeout),[2]}}))}))},t.prototype.cancelInviteHandler=function(e){this.log("cancelInviteHandler:",e),this.callStatus=d.idle,this.emit("onUserCancel",e.from)},t.prototype.rejectHandler=function(e){return l(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return this.log("rejectHandler:",e),this.filterCallingUserByMembers([{uid:"",account:e.from}]),"601"!==e.attachExt?[3,3]:(this.emit("onUserBusy",e.from),this.isGroupCall?[3,2]:[4,this.sendMessage(e.from,"busy")]);case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.emit("onUserReject",e.from),this.isGroupCall?[3,5]:[4,this.sendMessage(e.from,"rejected")];case 4:t.sent(),t.label=5;case 5:return this.isGroupCall?[3,7]:[4,this.destroy()];case 6:t.sent(),t.label=7;case 7:return[2]}}))}))},t.prototype.controlHandler=function(e){return l(this,void 0,void 0,(function(){var t,n;return c(this,(function(s){switch(s.label){case 0:this.log("controlHandler: ","channelInfo: ",this.channelInfo,"callType: ",this.callType,e),s.label=1;case 1:if(s.trys.push([1,6,,7]),!this.channelInfo)throw m;if(!this.callType)throw b;t=void 0;try{t=JSON.parse(e.attachExt)}catch(e){t={}}return 1!==t.cid?[3,3]:[4,this.joinRTCChannel()];case 2:return s.sent(),this.isGroupCall||(this.durations=[{accid:this.userMap[this.uid],duration:Date.now()},{accid:e.from,duration:Date.now()}]),this.log("controlHandler joinRTCChannel success",this.durations),[3,5];case 3:return 2!==t.cid?[3,5]:[4,this._enableLocalVideo(!1)];case 4:s.sent(),this.log("controlHandler switchCallType success"),s.label=5;case 5:return this.log("controlHandler success: "),[3,7];case 6:return n=s.sent(),this.log("controlHandler fail: ",n),[3,7];case 7:return[2]}}))}))},t.prototype.leaveHandler=function(e){return l(this,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:return this.log("leaveHandler:",e),this.remoteStreams=this.remoteStreams.filter((function(t){return t.getId()!==e.uid})),t=this.userMap[e.uid],delete this.userMap[e.uid],this.isGroupCall?[3,2]:[4,this.destroy()];case 1:n.sent(),n.label=2;case 2:return this.emit("onUserLeave",t),[2]}}))}))},t.version=M,t}(f);e.RTCCalling=k,Object.defineProperty(e,"__esModule",{value:!0})}));
